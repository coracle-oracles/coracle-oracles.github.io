{% extends 'coracle_pages/base.html' %}
{% load static %}

{% block title %}My Tickets - Coracle{% endblock %}

{% block head_extra_classes %}dashboard-header{% endblock %}

{% block head_content %}
<h1>My Tickets</h1>
<span class="subheading">View your purchased tickets</span>
{% endblock %}

{% block content %}
{% if not customer %}
    <div class="text-center py-4">
        <h3>Please log in to view your tickets</h3>
        <p class="text-muted">You need to be logged in to see your purchased ticket information.</p>
        <a href="/coracle/account/login?next=/dashboard/" class="btn btn-primary btn-lg mt-3">
            <i class="fas fa-sign-in-alt"></i> Log In
        </a>
        <p class="mt-3">
            <small class="text-muted">Don't have an account? <a href="/coracle/account/register">Register here</a></small>
        </p>
    </div>
{% elif not orders %}
    <div class="text-center py-4">
        <h3>No tickets found</h3>
        <p class="text-muted">You haven't purchased any tickets yet.</p>
        <a href="{% url 'ticket_info' %}" class="btn btn-primary btn-lg mt-3">
            <i class="fas fa-ticket-alt"></i> Purchase Tickets
        </a>
    </div>
{% else %}
    <div class="mb-4">
        <p class="text-muted">Welcome back, <strong>{{ customer.name }}</strong>!</p>
    </div>

    {% for order_data in orders %}
    <div class="card mb-4 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div>
                <strong>Order #{{ order_data.code }}</strong>
                <span class="badge
                    {% if order_data.status == 'p' %}bg-success
                    {% elif order_data.status == 'n' %}bg-warning text-dark
                    {% elif order_data.status == 'e' %}bg-secondary
                    {% else %}bg-danger{% endif %}
                    ms-2">
                    {{ order_data.status_display }}
                </span>
            </div>
            <small class="text-muted">{{ order_data.datetime|date:"M d, Y" }}</small>
        </div>
        <div class="card-body">
            <p class="mb-2">
                <i class="fas fa-calendar-alt me-2"></i>
                <strong>Event:</strong> {{ order_data.event }}
            </p>

            <h6 class="mt-3 mb-2">Tickets:</h6>
            <ul class="list-group list-group-flush">
                {% for ticket in order_data.tickets %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-ticket-alt me-2 text-primary"></i>
                        {{ ticket.item_name }}
                        {% if ticket.variation %}<small class="text-muted">({{ ticket.variation }})</small>{% endif %}
                        {% if ticket.attendee_name %}
                            <br><small class="text-muted"><i class="fas fa-user me-1"></i>{{ ticket.attendee_name }}</small>
                        {% endif %}
                    </div>
                    <span class="badge bg-primary rounded-pill">${{ ticket.price }}</span>
                </li>
                {% endfor %}
            </ul>

            <div class="mt-3 d-flex justify-content-between align-items-center">
                <strong>Total: ${{ order_data.total }}</strong>
                <a href="/coracle/{{ order_data.event.slug }}/order/{{ order_data.code }}/{{ order_data.secret }}/"
                   class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-external-link-alt me-1"></i> View Full Order
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
{% endif %}
{% endblock %}
